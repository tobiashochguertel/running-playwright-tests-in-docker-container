# READ: https://playwright.dev/python/docs/docker
services:
  playwright:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: playwright-tests-runner
    init: true
    ipc: 'host'
    cap_add:
      - SYS_ADMIN
    extra_hosts:
      - hostmachine:host-gateway
      # - host.docker.internal:host-gateway
    # Explicit command to run pytest with verbose output
    # Can be overridden with: docker-compose run --rm playwright <args>
    command: pytest -vv --tb=long tests/
    environment:
      PLAYWRIGHT_HEADLESS: 'true'
      # Ensure pytest output is not buffered (real-time log streaming)
      PYTHONUNBUFFERED: '1'
      # For testing local apps, use: http://host.docker.internal:3000
    # ports:
    #   - 3000:3000
    volumes:
      # Tests are copied into image during build, not mounted from host
      - ./tests:/app/tests:ro
      # Output directories for results and reports
      - ./test-results:/app/test-results
      - ./htmlreport:/app/htmlreport
    working_dir: /app
    # Set timeout for test execution (default: no limit)
    # Docker will kill container if tests take longer than this
    stop_grace_period: 2m
