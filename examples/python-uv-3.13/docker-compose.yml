# READ: https://playwright.dev/python/docs/docker
services:
  playwright:
    build:
      context: .
      dockerfile: Dockerfile
      # Show build output for debugging
      args:
        BUILDKIT_PROGRESS: plain
    container_name: playwright-tests-runner
    init: true
    ipc: 'host'
    cap_add:
      - SYS_ADMIN
    extra_hosts:
      - hostmachine:host-gateway
      # - host.docker.internal:host-gateway
    # Command defined in Dockerfile CMD - cleaner separation
    # Override with: docker-compose run --rm playwright <args>
    # Example: docker-compose run --rm playwright -vv tests/test_google.py
    environment:
      PLAYWRIGHT_HEADLESS: 'true'
      # Ensure pytest output is not buffered (real-time log streaming)
      PYTHONUNBUFFERED: '1'
      # Required for xvfb (virtual display)
      DISPLAY: ':99'
      # For testing local apps, use: http://host.docker.internal:3000
    # ports:
    #   - 3000:3000
    volumes:
      # Mount tests as read-only for development convenience
      # Tests are also baked into image during build
      - ./tests:/app/tests:ro
      # Output directories for results and reports
      - ./test-results:/app/test-results
      - ./htmlreport:/app/htmlreport
    working_dir: /app
    # Set timeout for test execution
    # Docker will kill container if tests take longer than this
    stop_grace_period: 5m
