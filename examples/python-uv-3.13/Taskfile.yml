version: '3'

# Playwright Docker Test Container - Task Automation
#
# This Taskfile provides convenient commands for building and running
# different browser variants of the Playwright test container.
#
# Prerequisites:
#   - go-task installed (https://taskfile.dev/)
#   - Docker installed and running
#
# Usage:
#   task --list                 # List all available tasks
#   task build:firefox          # Build firefox variant
#   task build:chromium         # Build chromium variant
#   task build:webkit           # Build webkit variant
#   task build:all              # Build all browser variants
#   task run:firefox            # Run firefox variant
#   task test:firefox           # Build and test firefox variant
#   task clean                  # Remove all built images

env:
  USER: $USER

vars:
  # Image configuration
  IMAGE_ORGANIZATION: '{{.USER}}'
  IMAGE_NAME: '{{.IMAGE_ORGANIZATION}}/playwright-test'
  PYTHON_VERSION: '3.13'

  # ANSI Color Codes for help text
  ## Colors:
  # Dark Variants
  COLOR_CYAN: '\033[36m'
  COLOR_YELLOW: '\033[33m'
  COLOR_GREEN: '\033[32m'
  COLOR_MAGENTA: '\033[35m'
  COLOR_BLUE: '\033[34m'
  COLOR_RED: '\033[31m'
  COLOR_WHITE: '\033[37m'
  COLOR_GRAY: '\033[90m'
  # Light Variants
  COLOR_LIGHT_CYAN: '\033[96m'
  COLOR_LIGHT_YELLOW: '\033[93m'
  COLOR_LIGHT_GREEN: '\033[92m'
  COLOR_LIGHT_MAGENTA: '\033[95m'
  COLOR_LIGHT_BLUE: '\033[94m'
  COLOR_LIGHT_RED: '\033[91m'
  COLOR_LIGHT_WHITE: '\033[97m'
  COLOR_LIGHT_GRAY: '\033[37m'
  # Bold Dark Variants
  COLOR_BOLD_CYAN: '\033[1;36m'
  COLOR_BOLD_YELLOW: '\033[1;33m'
  COLOR_BOLD_GREEN: '\033[1;32m'
  COLOR_BOLD_MAGENTA: '\033[1;35m'
  COLOR_BOLD_BLUE: '\033[1;34m'
  COLOR_BOLD_RED: '\033[1;31m'
  COLOR_BOLD_WHITE: '\033[1;37m'
  COLOR_BOLD_GRAY: '\033[1;90m'
  # Light Dark Variants
  COLOR_BOLD_LIGHT_CYAN: '\033[1;96m'
  COLOR_BOLD_LIGHT_YELLOW: '\033[1;93m'
  COLOR_BOLD_LIGHT_GREEN: '\033[1;92m'
  COLOR_BOLD_LIGHT_MAGENTA: '\033[1;95m'
  COLOR_BOLD_LIGHT_BLUE: '\033[1;94m'
  COLOR_BOLD_LIGHT_RED: '\033[1;91m'
  COLOR_BOLD_LIGHT_WHITE: '\033[1;97m'
  COLOR_BOLD_LIGHT_GRAY: '\033[1;37m'
  # Modifiers
  COLOR_DIM: '{{.COLOR_GRAY}}'
  COLOR_BOLD: '\033[1m'
  COLOR_RESET: '\033[0m'

tasks:
  debug:
    desc: Show current variable values for debugging
    cmds:
      - |
        echo "IMAGE_ORGANIZATION: {{.IMAGE_ORGANIZATION}}"
        echo "IMAGE_NAME: {{.IMAGE_NAME}}"
        echo "PYTHON_VERSION: {{.PYTHON_VERSION}}"

  debug:colors:
    desc: |
      List all colors available in 256 color mode with their codes.

      References:
        - https://colors.sh/
        - https://stackoverflow.com/a/33206814/2131390
        - https://jafrog.com/2013/11/23/colors-in-terminal.html
    cmds:
      - |
        for code in {0..255}
          do echo -e "\e[38;5;${code}m"'\\e[38;5;'"$code"m"\e[0m"
        done

  debug:colors:basic-8:
    desc: |
      List all colors available in basic 8-color mode with their codes.

      References:
        - https://gist.github.com/JBlond/2fea43a3049b38287e5e9cefc87b2124?permalink_comment_id=5414733#gistcomment-5414733
    cmds:
      - |
        for x in {0..5}; do echo --- && for z in 0 10 60 70; do for y in {30..37}; do y=$((y + z)) && printf '\e[%d;%dm%-12s\e[0m' "$x" "$y" "$(printf ' \\e[%d;%dm] ' "$x" "$y")" && printf ' '; done && printf '\n'; done; done

  debug:colors:with-names:
    desc: |
      List some colors with names (name follows a pattern)

      References:
        - https://gist.github.com/JBlond/2fea43a3049b38287e5e9cefc87b2124?permalink_comment_id=5132462#gistcomment-5132462
    cmds:
      - |
        printf "\e[0;30mBlack\n"
        printf "\e[0;31mRed\n"
        printf "\e[0;32mGreen\n"
        printf "\e[0;33mYellow\n"
        printf "\e[0;34mBlue\n"
        printf "\e[0;35mPurple\n"
        printf "\e[0;36mCyan\n"
        printf "\e[0;37mWhite\n"

        printf "\e[1;30mbold Black\n"
        printf "\e[1;31mbold Red\n"
        printf "\e[1;32mbold Green\n"
        printf "\e[1;33mbold Yellow\n"
        printf "\e[1;34mbold Blue\n"
        printf "\e[1;35mbold Purple\n"
        printf "\e[1;36mbold Cyan\n"
        printf "\e[1;37mbold White\n"

        printf "\e[0;90mhigh intensity Black\n"
        printf "\e[0;91mhigh intensity Red\n"
        printf "\e[0;92mhigh intensity Green\n"
        printf "\e[0;93mhigh intensity Yellow\n"
        printf "\e[0;94mhigh intensity Blue\n"
        printf "\e[0;95mhigh intensity Purple\n"
        printf "\e[0;96mhigh intensity Cyan\n"
        printf "\e[0;97mhigh intensity White\n"

  # - export DOCKER_HOST="unix://$HOME/.colima/docker/docker.sock"
  # - export DOCKER_HOST="unix://$HOME/.colima/default/incus.sock"
  # - echo $DOCKER_HOST
  buildx:create:
    desc: Create and use Docker buildx builder for multi-platform builds
    cmds:
      # - docker buildx ls
      - docker buildx create
        --name mybuilder --use
        --driver docker-container
        --driver-opt default-load=true
      - docker buildx inspect --bootstrap
      - docker buildx ls
    status:
      # Get the builder named "mybuilder" if it exists
      - docker buildx ls --format=json | jq --exit-status -s '.[] | select(.Name == "mybuilder")'
      # Get the driver used by the builder and compare it with the `docker-container` driver
      - docker buildx ls --format=json | jq --exit-status -s '.[] | select(.Name == "mybuilder").Driver == "docker-container"'

  # Build Tasks
  # ============================================================================

  build:firefox:
    desc: Build Docker image with Firefox browser
    cmds:
      - docker buildx build
        --build-arg PYTHON_VERSION={{.PYTHON_VERSION}}
        --build-arg BROWSER=firefox
        --build-arg UV_CACHE_REFRESH=false
        -t {{.IMAGE_NAME}}:latest
        -t {{.IMAGE_NAME}}:firefox-py{{.PYTHON_VERSION}}
        -t {{.IMAGE_NAME}}:firefox
        .
    sources:
      - Taskfile.yml
      - Dockerfile
      - entrypoint.sh
      - pyproject.toml
      - tests/**/*.py
    status:
      # Get all built images
      # - docker images --all --format=json | jq -s '.[] | select(.Repository == "{{.IMAGE_NAME}}")'
      # Get the images named "{{.IMAGE_NAME}}:latest" if it exists
      - docker images --all --format=json | jq --exit-status -s '.[] | select(.Repository == "{{.IMAGE_NAME}}") | select(.Tag == "latest").Tag == "latest"'
      # Get the images named "{{.IMAGE_NAME}}:firefox-py{{.PYTHON_VERSION}}" if it exists
      - docker images --all --format=json | jq --exit-status -s '.[] | select(.Repository == "{{.IMAGE_NAME}}") | select(.Tag == "firefox-py{{.PYTHON_VERSION}}").Tag == "firefox-py{{.PYTHON_VERSION}}"'
      # Get the images named "{{.IMAGE_NAME}}:firefox" if it exists
      - docker images --all --format=json | jq --exit-status -s '.[] | select(.Repository == "{{.IMAGE_NAME}}") | select(.Tag == "firefox").Tag == "firefox"'

  build:chromium:
    desc: Build Docker image with Chromium browser
    cmds:
      - docker build
        --build-arg PYTHON_VERSION={{.PYTHON_VERSION}}
        --build-arg BROWSER=chromium
        --build-arg UV_CACHE_REFRESH=false
        -t {{.IMAGE_NAME}}:chromium-py{{.PYTHON_VERSION}}
        -t {{.IMAGE_NAME}}:chromium
        .
    sources:
      - Taskfile.yml
      - Dockerfile
      - entrypoint.sh
      - pyproject.toml
      - tests/**/*.py
    status:
      # Get all built images
      # - docker images --all --format=json | jq -s '.[] | select(.Repository == "{{.IMAGE_NAME}}")'
      # Get the images named "{{.IMAGE_NAME}}:chromium-py{{.PYTHON_VERSION}}" if it exists
      - docker images --all --format=json | jq --exit-status -s '.[] | select(.Repository == "{{.IMAGE_NAME}}") | select(.Tag == "chromium-py{{.PYTHON_VERSION}}").Tag == "chromium-py{{.PYTHON_VERSION}}"'
      # Get the images named "{{.IMAGE_NAME}}:chromium" if it exists
      - docker images --all --format=json | jq --exit-status -s '.[] | select(.Repository == "{{.IMAGE_NAME}}") | select(.Tag == "chromium").Tag == "chromium"'

  build:webkit:
    desc: Build Docker image with WebKit browser
    cmds:
      - docker build
        --build-arg PYTHON_VERSION={{.PYTHON_VERSION}}
        --build-arg BROWSER=webkit
        --build-arg UV_CACHE_REFRESH=false
        -t {{.IMAGE_NAME}}:webkit-py{{.PYTHON_VERSION}}
        -t {{.IMAGE_NAME}}:webkit
        .
    sources:
      - Taskfile.yml
      - Dockerfile
      - entrypoint.sh
      - pyproject.toml
      - tests/**/*.py
    status:
      # Get all built images
      # - docker images --all --format=json | jq -s '.[] | select(.Repository == "{{.IMAGE_NAME}}")'
      # Get the images named "{{.IMAGE_NAME}}:webkit-py{{.PYTHON_VERSION}}" if it exists
      - docker images --all --format=json | jq --exit-status -s '.[] | select(.Repository == "{{.IMAGE_NAME}}") | select(.Tag == "webkit-py{{.PYTHON_VERSION}}").Tag == "webkit-py{{.PYTHON_VERSION}}"'
      # Get the images named "{{.IMAGE_NAME}}:webkit" if it exists
      - docker images --all --format=json | jq --exit-status -s '.[] | select(.Repository == "{{.IMAGE_NAME}}") | select(.Tag == "webkit").Tag == "webkit"'

  build:all-browsers:
    desc: Build Docker image with all browsers (firefox, chromium, webkit)
    cmds:
      - docker build
        --build-arg PYTHON_VERSION={{.PYTHON_VERSION}}
        --build-arg BROWSER=all
        --build-arg UV_CACHE_REFRESH=false
        -t {{.IMAGE_NAME}}:all-py{{.PYTHON_VERSION}}
        -t {{.IMAGE_NAME}}:all
        .
    sources:
      - Taskfile.yml
      - Dockerfile
      - entrypoint.sh
      - pyproject.toml
      - tests/**/*.py
    status:
      # Get all built images
      # - docker images --all --format=json | jq -s '.[] | select(.Repository == "{{.IMAGE_NAME}}")'
      # Get the images named "{{.IMAGE_NAME}}:all-py{{.PYTHON_VERSION}}" if it exists
      - docker images --all --format=json | jq --exit-status -s '.[] | select(.Repository == "{{.IMAGE_NAME}}") | select(.Tag == "all-py{{.PYTHON_VERSION}}").Tag == "all-py{{.PYTHON_VERSION}}"'
      # Get the images named "{{.IMAGE_NAME}}:all" if it exists
      - docker images --all --format=json | jq --exit-status -s '.[] | select(.Repository == "{{.IMAGE_NAME}}") | select(.Tag == "all").Tag == "all"'

  build:all:
    desc: Build all browser variants (firefox, chromium, webkit, all-browsers)
    cmds:
      - task: build:firefox
      - task: build:chromium
      - task: build:webkit
      - task: build:all-browsers

  build:refresh:
    desc: Build with UV cache refresh enabled (forces dependency updates)
    cmds:
      - docker build
        --build-arg PYTHON_VERSION={{.PYTHON_VERSION}}
        --build-arg BROWSER=firefox
        --build-arg UV_CACHE_REFRESH=true
        --no-cache
        -t {{.IMAGE_NAME}}:firefox-py{{.PYTHON_VERSION}}
        -t {{.IMAGE_NAME}}:firefox
        -t {{.IMAGE_NAME}}:latest
        .

  # Run Tasks
  # ============================================================================

  run:firefox:
    desc: Run tests with Firefox browser
    deps: [build:firefox]
    cmds:
      - docker run --rm
        -v "$(pwd)/test-results:/app/test-results"
        -v "$(pwd)/htmlreport:/app/htmlreport"
        {{.IMAGE_NAME}}:firefox

  run:chromium:
    desc: Run tests with Chromium browser
    deps: [build:chromium]
    cmds:
      - docker run --rm
        -v "$(pwd)/test-results:/app/test-results"
        -v "$(pwd)/htmlreport:/app/htmlreport"
        {{.IMAGE_NAME}}:chromium

  run:webkit:
    desc: Run tests with WebKit browser
    deps: [build:webkit]
    cmds:
      - docker run --rm
        -v "$(pwd)/test-results:/app/test-results"
        -v "$(pwd)/htmlreport:/app/htmlreport"
        {{.IMAGE_NAME}}:webkit

  run:all:
    desc: Run tests with all browser variants sequentially
    cmds:
      - task: run:firefox
      - task: run:chromium
      - task: run:webkit

  # Test Tasks (Build + Run)
  # ============================================================================

  test:firefox:
    desc: Build and test Firefox variant
    cmds:
      - task: build:firefox
      - task: run:firefox

  test:chromium:
    desc: Build and test Chromium variant
    cmds:
      - task: build:chromium
      - task: run:chromium

  test:webkit:
    desc: Build and test WebKit variant
    cmds:
      - task: build:webkit
      - task: run:webkit

  test:all:
    desc: Build and test all browser variants
    cmds:
      - task: build:all
      - task: run:all

  # Custom Environment Tasks
  # ============================================================================

  test:verbose:
    desc: Run tests with verbose output and long tracebacks
    deps: [build:firefox]
    cmds:
      - docker run --rm
        -e PYTEST_VERBOSE=-vvv
        -e PYTEST_TRACEBACK=long
        -v "$(pwd)/test-results:/app/test-results"
        -v "$(pwd)/htmlreport:/app/htmlreport"
        {{.IMAGE_NAME}}:firefox

  test:no-colors:
    desc: Run tests with NO_COLORS enabled
    deps: [build:firefox]
    cmds:
      - docker run --rm
        -e NO_COLORS=1
        -v "$(pwd)/test-results:/app/test-results"
        -v "$(pwd)/htmlreport:/app/htmlreport"
        {{.IMAGE_NAME}}:firefox

  test:custom-display:
    desc: Run tests with custom DISPLAY and resolution
    deps: [build:firefox]
    cmds:
      - docker run --rm
        -e DISPLAY=:100
        -e XVFB_RESOLUTION=1920x1080x24
        -v "$(pwd)/test-results:/app/test-results"
        -v "$(pwd)/htmlreport:/app/htmlreport"
        {{.IMAGE_NAME}}:firefox

  # Development Tasks
  # ============================================================================

  shell:firefox:
    desc: Start interactive shell in Firefox container
    deps: [build:firefox]
    cmds:
      - docker run --rm -it
        --entrypoint /bin/bash
        {{.IMAGE_NAME}}:firefox

  shell:chromium:
    desc: Start interactive shell in Chromium container
    deps: [build:chromium]
    cmds:
      - docker run --rm -it
        --entrypoint /bin/bash
        {{.IMAGE_NAME}}:chromium

  inspect:
    desc: Show browser installation in container (requires browser variant)
    cmds:
      - docker run --rm
        {{.IMAGE_NAME}}:{{.BROWSER | default "firefox"}}
        .venv/bin/playwright show-browsers

  # Cleanup Tasks
  # ============================================================================

  clean:
    desc: Remove all built images
    cmds:
      - docker rmi {{.IMAGE_NAME}}:firefox-py{{.PYTHON_VERSION}} 2>/dev/null || true
      - docker rmi {{.IMAGE_NAME}}:firefox 2>/dev/null || true
      - docker rmi {{.IMAGE_NAME}}:chromium-py{{.PYTHON_VERSION}} 2>/dev/null || true
      - docker rmi {{.IMAGE_NAME}}:chromium 2>/dev/null || true
      - docker rmi {{.IMAGE_NAME}}:webkit-py{{.PYTHON_VERSION}} 2>/dev/null || true
      - docker rmi {{.IMAGE_NAME}}:webkit 2>/dev/null || true
      - docker rmi {{.IMAGE_NAME}}:all-py{{.PYTHON_VERSION}} 2>/dev/null || true
      - docker rmi {{.IMAGE_NAME}}:all 2>/dev/null || true
      - docker rmi {{.IMAGE_NAME}}:latest 2>/dev/null || true
      - echo "âœ“ Cleaned up all {{.IMAGE_NAME}} images"

  clean:reports:
    desc: Remove test results and HTML reports
    cmds:
      - rm -rf test-results/* htmlreport/*
      - echo "âœ“ Cleaned up test reports"

  clean:all:
    desc: Remove all images and reports
    cmds:
      - task: clean
      - task: clean:reports

  # Information Tasks
  # ============================================================================

  list-images:
    desc: List all built images
    cmds:
      - docker images | grep {{.IMAGE_NAME}} || echo "No {{.IMAGE_NAME}} images found"

  size:
    desc: Show image sizes for all variants
    cmds:
      - docker images {{.IMAGE_NAME}} --format "table {{.Repository}}\t{{.Tag}}\t{{.Size}}"

  help:
    desc: Show detailed usage information
    silent: true
    cmds:
      - |
        echo -e "$(cat <<'EOF'
        {{.COLOR_BOLD_CYAN}}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—{{.COLOR_RESET}}
        {{.COLOR_BOLD_CYAN}}â•‘  {{.COLOR_BOLD_YELLOW}}Playwright Docker Test Container{{.COLOR_BOLD_CYAN}} - Task Automation            â•‘{{.COLOR_RESET}}
        {{.COLOR_BOLD_CYAN}}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•{{.COLOR_RESET}}

        {{.COLOR_BOLD_GREEN}}ðŸ“¦ Quick Start:{{.COLOR_RESET}}
          {{.COLOR_BOLD_WHITE}}task build:firefox{{.COLOR_RESET}}          {{.COLOR_GRAY}}# Build Firefox variant (default){{.COLOR_RESET}}
          {{.COLOR_BOLD_WHITE}}task run:firefox{{.COLOR_RESET}}            {{.COLOR_GRAY}}# Run tests with Firefox{{.COLOR_RESET}}
          {{.COLOR_BOLD_WHITE}}task test:firefox{{.COLOR_RESET}}           {{.COLOR_GRAY}}# Build + Run Firefox tests{{.COLOR_RESET}}

        {{.COLOR_BOLD_MAGENTA}}ðŸ¦Š Firefox Variant:{{.COLOR_RESET}}
          {{.COLOR_BOLD_WHITE}}task build:firefox{{.COLOR_RESET}}          {{.COLOR_GRAY}}# Build Firefox image{{.COLOR_RESET}}
          {{.COLOR_BOLD_WHITE}}task run:firefox{{.COLOR_RESET}}            {{.COLOR_GRAY}}# Run tests with Firefox{{.COLOR_RESET}}
          {{.COLOR_BOLD_WHITE}}task test:firefox{{.COLOR_RESET}}           {{.COLOR_GRAY}}# Build + test Firefox{{.COLOR_RESET}}

        {{.COLOR_BOLD_BLUE}}ðŸŒ Chromium Variant:{{.COLOR_RESET}}
          {{.COLOR_BOLD_WHITE}}task build:chromium{{.COLOR_RESET}}         {{.COLOR_GRAY}}# Build Chromium image{{.COLOR_RESET}}
          {{.COLOR_BOLD_WHITE}}task run:chromium{{.COLOR_RESET}}           {{.COLOR_GRAY}}# Run tests with Chromium{{.COLOR_RESET}}
          {{.COLOR_BOLD_WHITE}}task test:chromium{{.COLOR_RESET}}          {{.COLOR_GRAY}}# Build + test Chromium{{.COLOR_RESET}}

        {{.COLOR_BOLD_CYAN}}ðŸ§ª WebKit Variant:{{.COLOR_RESET}}
          {{.COLOR_BOLD_WHITE}}task build:webkit{{.COLOR_RESET}}           {{.COLOR_GRAY}}# Build WebKit image{{.COLOR_RESET}}
          {{.COLOR_BOLD_WHITE}}task run:webkit{{.COLOR_RESET}}             {{.COLOR_GRAY}}# Run tests with WebKit{{.COLOR_RESET}}
          {{.COLOR_BOLD_WHITE}}task test:webkit{{.COLOR_RESET}}            {{.COLOR_GRAY}}# Build + test WebKit{{.COLOR_RESET}}

        {{.COLOR_BOLD_YELLOW}}ðŸš€ All Variants:{{.COLOR_RESET}}
          {{.COLOR_BOLD_WHITE}}task build:all{{.COLOR_RESET}}              {{.COLOR_GRAY}}# Build all browser variants{{.COLOR_RESET}}
          {{.COLOR_BOLD_WHITE}}task test:all{{.COLOR_RESET}}               {{.COLOR_GRAY}}# Build + test all variants{{.COLOR_RESET}}

        {{.COLOR_BOLD_GREEN}}ðŸ³ Docker Compose:{{.COLOR_RESET}}
          {{.COLOR_BOLD_WHITE}}task compose:up{{.COLOR_RESET}}             {{.COLOR_GRAY}}# Start tests with docker-compose{{.COLOR_RESET}}
          {{.COLOR_BOLD_WHITE}}task compose:down{{.COLOR_RESET}}           {{.COLOR_GRAY}}# Stop and remove containers{{.COLOR_RESET}}
          {{.COLOR_BOLD_WHITE}}task compose:logs{{.COLOR_RESET}}           {{.COLOR_GRAY}}# Show container logs{{.COLOR_RESET}}
          {{.COLOR_BOLD_WHITE}}task compose:firefox{{.COLOR_RESET}}        {{.COLOR_GRAY}}# Run Firefox profile{{.COLOR_RESET}}
          {{.COLOR_BOLD_WHITE}}task compose:chromium{{.COLOR_RESET}}       {{.COLOR_GRAY}}# Run Chromium profile{{.COLOR_RESET}}
          {{.COLOR_BOLD_WHITE}}task compose:webkit{{.COLOR_RESET}}         {{.COLOR_GRAY}}# Run WebKit profile{{.COLOR_RESET}}

        {{.COLOR_BOLD_CYAN}}ðŸ”§ Development:{{.COLOR_RESET}}
          {{.COLOR_BOLD_WHITE}}task shell:firefox{{.COLOR_RESET}}            {{.COLOR_GRAY}}# Interactive shell in container{{.COLOR_RESET}}
          {{.COLOR_BOLD_WHITE}}task inspect BROWSER=firefox{{.COLOR_RESET}}  {{.COLOR_GRAY}}# Show browser installation{{.COLOR_RESET}}

        {{.COLOR_BOLD_RED}}ðŸ§¹ Cleanup:{{.COLOR_RESET}}
          {{.COLOR_BOLD_WHITE}}task clean{{.COLOR_RESET}}                  {{.COLOR_GRAY}}# Remove all built images{{.COLOR_RESET}}
          {{.COLOR_BOLD_WHITE}}task clean:reports{{.COLOR_RESET}}          {{.COLOR_GRAY}}# Remove test reports{{.COLOR_RESET}}
          {{.COLOR_BOLD_WHITE}}task clean:all{{.COLOR_RESET}}              {{.COLOR_GRAY}}# Remove images + reports{{.COLOR_RESET}}

        {{.COLOR_BOLD_YELLOW}}ðŸ“Š Information:{{.COLOR_RESET}}
          {{.COLOR_BOLD_WHITE}}task list-images{{.COLOR_RESET}}            {{.COLOR_GRAY}}# List all built images{{.COLOR_RESET}}
          {{.COLOR_BOLD_WHITE}}task size{{.COLOR_RESET}}                   {{.COLOR_GRAY}}# Show image sizes{{.COLOR_RESET}}

        {{.COLOR_MAGENTA}}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”{{.COLOR_RESET}}

        {{.COLOR_GRAY}}For full list:{{.COLOR_RESET}} {{.COLOR_BOLD_WHITE}}task --list{{.COLOR_RESET}}
        {{.COLOR_GRAY}}For task info:{{.COLOR_RESET}} {{.COLOR_BOLD_WHITE}}task --summary <task-name>{{.COLOR_RESET}}\n
        EOF
        )"

  default:
    desc: Show help (default task when running just 'task')
    cmds:
      - task: help

  # ============================================================================
  # Docker Compose Tasks
  # ============================================================================

  compose:up:
    desc: Start tests using docker-compose (firefox profile - default)
    dir: '{{.TASKFILE_DIR}}'
    cmds:
      - docker-compose up --abort-on-container-exit

  compose:up:firefox:
    desc: Start tests using docker-compose firefox profile
    dir: '{{.TASKFILE_DIR}}'
    cmds:
      - docker-compose up --abort-on-container-exit

  compose:up:chromium:
    desc: Start tests using docker-compose chromium profile
    dir: '{{.TASKFILE_DIR}}'
    cmds:
      - docker-compose --profile chromium up --abort-on-container-exit

  compose:up:webkit:
    desc: Start tests using docker-compose webkit profile
    dir: '{{.TASKFILE_DIR}}'
    cmds:
      - docker-compose --profile webkit up --abort-on-container-exit

  compose:up:all:
    desc: Start tests using docker-compose all-browsers profile
    dir: '{{.TASKFILE_DIR}}'
    cmds:
      - docker-compose --profile all up --abort-on-container-exit

  compose:firefox:
    desc: Shorthand for compose:up:firefox
    cmds:
      - task: compose:up:firefox

  compose:chromium:
    desc: Shorthand for compose:up:chromium
    cmds:
      - task: compose:up:chromium

  compose:webkit:
    desc: Shorthand for compose:up:webkit
    cmds:
      - task: compose:up:webkit

  compose:build:
    desc: Build docker-compose images
    dir: '{{.TASKFILE_DIR}}'
    cmds:
      - docker-compose build

  compose:down:
    desc: Stop and remove docker-compose containers
    dir: '{{.TASKFILE_DIR}}'
    cmds:
      - docker-compose down

  compose:logs:
    desc: Show docker-compose logs (follow mode)
    dir: '{{.TASKFILE_DIR}}'
    cmds:
      - docker-compose logs -f

  compose:ps:
    desc: Show docker-compose container status
    dir: '{{.TASKFILE_DIR}}'
    cmds:
      - docker-compose ps

  compose:restart:
    desc: Restart docker-compose containers
    dir: '{{.TASKFILE_DIR}}'
    cmds:
      - docker-compose restart
